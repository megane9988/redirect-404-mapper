# Redirect 404 Mapper

404ページにアクセスされたURLをマッピングし、JavaScriptで指定先にリダイレクトするWordPressプラグイン。

## 説明

このプラグインは、存在しないページへのアクセス（404エラー）を検出し、管理画面で設定したリダイレクトルールに基づいて自動的に別のURLへリダイレクトします。

全てのリダイレクト処理はJavaScriptで実行されるため、サーバーサイドのリダイレクトより高速に動作します。

## 機能

- **ルール管理UI**: WordPressの管理画面から簡単にリダイレクトルールを追加・編集できます
- **動的なリダイレクト**: 404ページにアクセスしたURLを自動判定し、JavaScriptでリダイレクト
- **柔軟なURL指定**: パスとクエリ文字列の完全一致で判定
- **セキュアな実装**: 入力値の適切なサニタイズとエスケープ

## 必須環境

- WordPress 5.0以上
- PHP 7.2以上

## インストール

1. このプラグインをダウンロード
2. `/wp-content/plugins/` ディレクトリに `redirect-404-mapper` フォルダをアップロード
3. WordPress管理画面のプラグイン一覧ページで「Redirect 404 Mapper」を有効化

## 使い方

### ルールの登録

1. 管理画面のサイドメニューから **設定 > 404 Redirect Mapper** を開く
2. 以下の情報を入力：
   - **404 URL (from)**: リダイレクト元のパス（例: `/old-page/`）
   - **Redirect URL (to)**: リダイレクト先の完全なURL（例: `https://example.com/new-page/`）
3. **「Add Rule」** ボタンで行を追加できます
4. **「変更を保存」** ボタンをクリックして保存

### クエリ文字列を含む場合

クエリ文字列を含めてマッピングすることもできます：

```
404 URL (from): /old-page/?param=value
Redirect URL (to): https://example.com/new-page/
```

### 動作

404ページへアクセスすると、以下の処理が実行されます：

1. ブラウザのHeadセクションに全ルールが埋め込まれたJavaScriptが出力される
2. JavaScriptが現在のURL（パス + クエリ）と登録されたルールを比較
3. マッチするルールがあればそのリダイレクト先へ遷移
4. マッチするルールがなければ404ページをそのまま表示

## トラブルシューティング

### リダイレクトが動作しない場合

- 登録した「404 URL (from)」が、実際にアクセスしたパスと完全に一致しているか確認してください
- ブラウザの開発者ツール（F12）のコンソール/ネットワークタブで確認
- `window.location.pathname` で現在のパスを確認できます

### 特定のページだけリダイレクトされたくない

ルール管理画面でそのルール行の **「Remove」** ボタンをクリックして削除し、保存してください。

## よくある質問

**Q: 404以外のページでもリダイレクトされる？**  
A: いいえ。このプラグインは404ページでのみ動作します。

**Q: サーバーサイドのリダイレクト（HTTPステータス301/302）ではなくて、なぜJavaScript？**  
A: JavaScriptリダイレクトは、ブラウザのHistory APIを使わないため、ユーザーの戻るボタン操作に影響を与えません。

**Q: リダイレクトの優先順位は？**  
A: 登録されたルールを上から順に検索し、最初にマッチしたルールでリダイレクトされます。

## スクリーンショット

1. **ルール管理画面** - リダイレクトルールの追加・編集画面

## ライセンス

GPL v2.0以上。詳細は [LICENSE](LICENSE) ファイルを参照してください。

## 作者

mgn

## 変更履歴

### Version 1.0.0

初回リリース。
